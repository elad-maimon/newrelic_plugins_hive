#!/usr/bin/env ruby
require 'rubygems'
require 'bundler/setup'

require 'daemons'
require 'slop'

require 'newrelic_plugins_hive'

opts = Slop.parse(ARGV, :help => true) do
  on :v, 'Print the version' do
    puts "NewRelic Plugins Hive version #{NewRelicPluginsHive::VERSION}"
  end

  command :install do
    run { |opts, args| NewRelicPluginsHive.install }
  end

  command :run do
    on :d, :daemon=, 'Daemonizing options. Use: run, start, stop, restart, status'
    
    run do |opts, args|
      if opts[:daemon]
        ARGV.clear
        ARGV.push(opts[:daemon])
        Daemons.run(File.dirname(__FILE__) + '/hive_daemon_wrapper')
      else
        NewRelicPluginsHive.run
      end
    end
  end
end
